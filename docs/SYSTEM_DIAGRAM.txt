# DIAGRAMA DEL SISTEMA OCR

## FLUJO DE USUARIO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USUARIO EN /gastos                               â”‚
â”‚                                                                     â”‚
â”‚  [BotÃ³n "Cargar Recibo (OCR)"] â† [BotÃ³n "Nuevo Gasto"]            â”‚
â”‚            â†“                                                         â”‚
â”‚  Modal se abre (Step 1)                                             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PASO 1: CARGAR IMAGEN                          â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [Seleccionar archivo]                                        â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ ğŸ“· Vista previa de imagen                                  â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ [Procesar con OCR]                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  Formatos soportados: PNG, JPG, GIF, WEBP                          â”‚
â”‚  TamaÃ±o mÃ¡ximo recomendado: 10MB                                   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                          (ENVÃO A SERVIDOR)
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SERVIDOR: app.py /gastos/upload-recibo                â”‚
â”‚                                                                     â”‚
â”‚  1. Recibe archivo                                                  â”‚
â”‚  2. Valida tipo (extensiÃ³n)                                         â”‚
â”‚  3. Verifica Tesseract disponible                                   â”‚
â”‚  4. EnvÃ­a a ocr_processing.py                                       â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            SERVIDOR: ocr_processing.py (ReceiptOCR)                â”‚
â”‚                                                                     â”‚
â”‚  process_image_bytes(file_bytes)                                    â”‚
â”‚       â†“                                                             â”‚
â”‚  1. Abre imagen con PIL (Pillow)                                    â”‚
â”‚  2. Optimiza: redimensiona si es pequeÃ±a                            â”‚
â”‚  3. EnvÃ­a a Tesseract OCR                                           â”‚
â”‚  4. Extrae texto RAW                                                â”‚
â”‚       â†“                                                             â”‚
â”‚  5. Procesa con regex patterns:                                     â”‚
â”‚     â€¢ _extract_amount()    â†’ Busca "Total:" "Monto:"               â”‚
â”‚     â€¢ _extract_date()      â†’ Busca formatos DD/MM/YYYY             â”‚
â”‚     â€¢ _extract_description()â†’ Primeras lÃ­neas                       â”‚
â”‚     â€¢ _extract_supplier()  â†’ Primera lÃ­nea significativa            â”‚
â”‚     â€¢ _calculate_confidence()â†’ % de confianza (0-100%)             â”‚
â”‚       â†“                                                             â”‚
â”‚  6. Retorna JSON con datos extraÃ­dos                                â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                      (RESPUESTA AL NAVEGADOR)
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PASO 2: REVISAR Y AJUSTAR                       â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â­ Confianza: 85% - Datos muy precisos                      â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ DescripciÃ³n:  [________________] (texto extraÃ­do)           â”‚  â”‚
â”‚  â”‚ Monto:        [__________] (nÃºmero extraÃ­do)               â”‚  â”‚
â”‚  â”‚ Fecha:        [__________] (fecha extraÃ­da)                â”‚  â”‚
â”‚  â”‚ CategorÃ­a:    [__________] (vacÃ­o - usuario rellena)       â”‚  â”‚
â”‚  â”‚ Suplidor:     [__________] (nombre extraÃ­do)               â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ [Volver] [Guardar Gasto]                                    â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚  â”‚
â”‚  â”‚ Texto extraÃ­do (RAW):                                       â”‚  â”‚
â”‚  â”‚ [FERRETERIA ABC]                                            â”‚  â”‚
â”‚  â”‚ [Fecha: 09/01/2024]                                         â”‚  â”‚
â”‚  â”‚ [TOTAL: 2.500,00]                                           â”‚  â”‚
â”‚  â”‚ ...                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  Usuario ajusta los campos segÃºn sea necesario                      â”‚
â”‚  Pueden editar cualquier valor antes de guardar                     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
              (Usuario hace clic en "Guardar Gasto")
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SERVIDOR: app.py /gastos/save-with-receipt                 â”‚
â”‚                                                                     â”‚
â”‚  1. Recibe datos del formulario                                     â”‚
â”‚  2. Valida campos requeridos                                        â”‚
â”‚  3. Crea nuevo registro en DB (expenses)                            â”‚
â”‚  4. Guarda imagen:                                                  â”‚
â”‚     expenses.save_receipt_image() â†’                                 â”‚
â”‚       - Crea carpeta static/uploads si no existe                    â”‚
â”‚       - Genera nombre: receipt_{id}_{timestamp}.png                 â”‚
â”‚       - Retorna ruta relativa                                       â”‚
â”‚  5. Actualiza registro con receipt_path                             â”‚
â”‚  6. Redirige a /gastos con mensaje de Ã©xito                         â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BASE DE DATOS (SQLite)                           â”‚
â”‚                                                                     â”‚
â”‚  Tabla: expenses                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ id          â”‚ 42                                             â”‚  â”‚
â”‚  â”‚ description â”‚ "FERRETERIA ABC - Compra de materiales"       â”‚  â”‚
â”‚  â”‚ amount      â”‚ 2500.00                                        â”‚  â”‚
â”‚  â”‚ category    â”‚ "Materiales"                                   â”‚  â”‚
â”‚  â”‚ supplier_id â”‚ 5                                              â”‚  â”‚
â”‚  â”‚ date        â”‚ "2024-01-09"                                   â”‚  â”‚
â”‚  â”‚ receipt_pathâ”‚ "static/uploads/receipt_42_20240109_143025.png"â”‚  â”‚
â”‚  â”‚ created_at  â”‚ "2024-01-09T14:30:25"                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  Archivo guardado:                                                  â”‚
â”‚  static/uploads/receipt_42_20240109_143025.png (imagen real)        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   âœ… GASTO REGISTRADO CON Ã‰XITO                     â”‚
â”‚                                                                     â”‚
â”‚  El usuario vuelve a la lista de gastos                             â”‚
â”‚  Puede ver el nuevo gasto con:                                      â”‚
â”‚  - DescripciÃ³n extraÃ­da                                             â”‚
â”‚  - Monto correcto                                                   â”‚
â”‚  - Fecha extraÃ­da                                                   â”‚
â”‚  - Imagen del recibo como evidencia                                â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ARQUITECTURA DE COMPONENTES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          NAVEGADOR (Cliente)                         â”‚
â”‚                                                                      â”‚
â”‚  templates/gastos.html                                              â”‚
â”‚  â”œâ”€ Modal OCR (nuevo)                                               â”‚
â”‚  â”‚  â”œâ”€ Step 1: Carga de imagen                                      â”‚
â”‚  â”‚  â”‚  â”œâ”€ Input file (receptFileInput)                              â”‚
â”‚  â”‚  â”‚  â”œâ”€ Preview (previewImage)                                    â”‚
â”‚  â”‚  â”‚  â””â”€ BotÃ³n "Procesar OCR"                                      â”‚
â”‚  â”‚  â”‚                                                               â”‚
â”‚  â”‚  â””â”€ Step 2: RevisiÃ³n de datos                                    â”‚
â”‚  â”‚     â”œâ”€ Campos editables (description, amount, etc)               â”‚
â”‚  â”‚     â”œâ”€ Raw text display                                          â”‚
â”‚  â”‚     â””â”€ BotÃ³n "Guardar Gasto"                                     â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â””â”€ JavaScript (fetch API):                                         â”‚
â”‚     â”œâ”€ uploadReceiptImage()     â†’ POST /gastos/upload-recibo       â”‚
â”‚     â””â”€ saveExpenseWithReceipt() â†’ POST /gastos/save-with-receipt   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†•
                          (HTTP Request/Response)
                                  â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SERVIDOR Flask (app.py)                       â”‚
â”‚                                                                      â”‚
â”‚  â”œâ”€ @app.route("/gastos/upload-recibo", methods=["POST"])          â”‚
â”‚  â”‚  â”œâ”€ Recibe: file (multipart/form-data)                          â”‚
â”‚  â”‚  â”œâ”€ Valida: extensiÃ³n, tipo MIME                                â”‚
â”‚  â”‚  â”œâ”€ Llama: ReceiptOCR.process_image_bytes()                     â”‚
â”‚  â”‚  â””â”€ Retorna: JSON con datos extraÃ­dos                           â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â””â”€ @app.route("/gastos/save-with-receipt", methods=["POST"])     â”‚
â”‚     â”œâ”€ Recibe: form data + receipt_file                            â”‚
â”‚     â”œâ”€ Valida: campos requeridos                                    â”‚
â”‚     â”œâ”€ Crea: nuevo gasto en DB                                     â”‚
â”‚     â”œâ”€ Guarda: imagen con expenses.save_receipt_image()            â”‚
â”‚     â”œâ”€ Actualiza: DB con ruta de imagen                            â”‚
â”‚     â””â”€ Redirige: a /gastos con mensaje de Ã©xito                    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MÃ“DULO: ocr_processing.py                        â”‚
â”‚                                                                      â”‚
â”‚  Clase: ReceiptOCR                                                  â”‚
â”‚  â”œâ”€ process_image_bytes(bytes)                                      â”‚
â”‚  â”‚  â”œâ”€ PIL.Image.open()          â†’ Abre imagen                    â”‚
â”‚  â”‚  â”œâ”€ _optimize_image()          â†’ Mejora calidad                â”‚
â”‚  â”‚  â”œâ”€ pytesseract.image_to_string() â†’ OCR                        â”‚
â”‚  â”‚  â”œâ”€ _extract_amount()          â†’ Busca monto                   â”‚
â”‚  â”‚  â”œâ”€ _extract_date()            â†’ Busca fecha                   â”‚
â”‚  â”‚  â”œâ”€ _extract_description()     â†’ Extrae descripciÃ³n           â”‚
â”‚  â”‚  â”œâ”€ _extract_supplier()        â†’ Busca suplidor               â”‚
â”‚  â”‚  â””â”€ _calculate_confidence()    â†’ Calcula certeza              â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â””â”€ check_tesseract_available()                                    â”‚
â”‚     â””â”€ Verifica que Tesseract estÃ¡ instalado                       â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MÃ“DULO: expenses.py                               â”‚
â”‚                                                                      â”‚
â”‚  â”œâ”€ add_expense()                (NUEVO: receipt_path param)        â”‚
â”‚  â”œâ”€ save_receipt_image()         (NUEVO)                            â”‚
â”‚  â”œâ”€ get_receipt_path()           (NUEVO)                            â”‚
â”‚  â”œâ”€ update_expense()                                                â”‚
â”‚  â”œâ”€ list_expenses()                                                 â”‚
â”‚  â””â”€ delete_expense()                                                â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BASE DE DATOS (db.py)                         â”‚
â”‚                                                                      â”‚
â”‚  Tabla: expenses (ACTUALIZADA)                                      â”‚
â”‚  â”œâ”€ id                  INTEGER PRIMARY KEY                         â”‚
â”‚  â”œâ”€ description         TEXT NOT NULL                               â”‚
â”‚  â”œâ”€ amount              REAL NOT NULL                               â”‚
â”‚  â”œâ”€ category            TEXT                                        â”‚
â”‚  â”œâ”€ supplier_id         INTEGER FK â†’ suppliers                     â”‚
â”‚  â”œâ”€ date                TEXT NOT NULL                               â”‚
â”‚  â”œâ”€ payment_method      TEXT                                        â”‚
â”‚  â”œâ”€ notes               TEXT                                        â”‚
â”‚  â”œâ”€ receipt_path        TEXT (NUEVO âœ¨)                             â”‚
â”‚  â””â”€ created_at          TEXT                                        â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SISTEMA DE ARCHIVOS                            â”‚
â”‚                                                                      â”‚
â”‚  static/uploads/                                                    â”‚
â”‚  â”œâ”€ receipt_1_20240109_140000.png                                  â”‚
â”‚  â”œâ”€ receipt_2_20240109_140500.png                                  â”‚
â”‚  â”œâ”€ receipt_3_20240109_141000.png                                  â”‚
â”‚  â””â”€ ... (mÃ¡s archivos)                                             â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## FLUJO DE DATOS JSON

### Request: POST /gastos/upload-recibo

```
Multipart Form Data:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ file: [imagen binaria]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Response: 200 OK

```json
{
  "success": true,
  "description": "FERRETERIA ABC - Ventas",
  "amount": 2500.00,
  "date": "2024-01-09",
  "supplier_name": "FERRETERIA ABC",
  "confidence": 0.85,
  "raw_text": "FERRETERIA ABC\n09/01/2024\n...",
  "message": "InformaciÃ³n extraÃ­da con 85% de confianza"
}
```

### Response: 422 ERROR

```json
{
  "success": false,
  "error": "No se pudo extraer texto de la imagen",
  "raw_text": "..."
}
```

---

**Diagrama creado**: 2024-01-09
**VersiÃ³n del sistema**: 1.0
**Estado**: âœ… Completamente funcional
